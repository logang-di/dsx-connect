# Global settings used by all dsx-connect subcharts
global:
  # Minimal, common env most users need to touch. Everything else is set in templates with sane defaults.
  env:
    DSXCONNECT_APP_ENV: dev
    DSXCONNECTOR_API_KEY: api-key-NOT-FOR-PRODUCTION
    # DSXCONNECT_SCANNER__SCAN_BINARY_URL: "http://<external-dsxa-host>:5000/scan/binary/v2"  # optional override

  # Optional shared image defaults (subcharts fall back to these when set)
  image:
    repository: dsxconnect/dsx-connect
    tag: "__VERSION__"
    pullPolicy: IfNotPresent

  # Optional scanner service hints used when dsxa-scanner subchart is enabled
  scanner:
    # serviceName: "dsxa-scanner"   # optional: explicit K8s service name (defaults to <release>-dsxa-scanner)
    # port: 5000                     # optional: override port (defaults to 5000)
    # scheme: http                   # optional: http|https (defaults to http)

# typical deployments would have dsxa-scanners in their own cluster and namespace, but for if all that's needed
# is a single dsxa-scanner pod that only supports scan/binary/v2 (file size <= 2GB), then enable here.
dsxa-scanner:
  enabled: false

dsx-connect-api:
  enabled: true
  service:
    port: 80
  tls:
    enabled: false
    port: 443
    secretName: ""
    mountPath: "/app/certs"
  env:
    LOG_LEVEL: debug

dsx-connect-scan-request-worker:
  enabled: true
  env:
    LOG_LEVEL: debug
  celery:
    # queue computed from DSXCONNECT_APP_ENV in template unless overridden here
    # queue: "dev.dsx_connect.scans.request"
    concurrency: 1

dsx-connect-verdict-action-worker:
  enabled: true
  env:
    LOG_LEVEL: debug
  celery:
    # queue: "dev.dsx_connect.scans.verdict"
    concurrency: 1

dsx-connect-results-worker:
  enabled: true
  env:
    LOG_LEVEL: debug
  celery:
    # queue: "dev.dsx_connect.scans.result"
    concurrency: 1

dsx-connect-notification-worker:
  enabled: true
  # image:
  env:
    LOG_LEVEL: debug
  celery:
    # queue: "dev.dsx_connect.scans.result.notify"
    concurrency: 1

redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
  command:
    - "redis-server"
    - "--notify-keyspace-events"
    - "Ex"
    - "--maxmemory-policy"
    - "allkeys-lru"
    - "--timeout"
    - "0"
    - "--tcp-keepalive"
    - "300"
    - "--appendonly"
    - "no"
  healthcheck:
    test: ["redis-cli", "ping"]
    interval: 10
    timeout: 3
    retries: 5
    startPeriod: 10

syslog:
  enabled: true
  image:
    repository: balabit/syslog-ng
    tag: latest
  service:
    port: 514 # Default syslog port
