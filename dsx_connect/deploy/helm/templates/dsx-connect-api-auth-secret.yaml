{{- $root := . -}}
{{- $api := default (dict) (index $root.Values "dsx-connect-api") -}}
{{- $auth := default (dict) $api.auth -}}
{{- $enrollment := default (dict) $auth.enrollment -}}
{{- $tokenValue := $enrollment.value -}}
{{- if and $api.enabled (default false $auth.enabled) $tokenValue }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dsx-connect-api.fullname" $root }}-auth-enrollment
  labels:
    {{- include "dsx-connect-api.labels" $root | nindent 4 }}
type: Opaque
data:
  {{ default "ENROLLMENT_TOKEN" $enrollment.key }}: {{ $tokenValue | b64enc | quote }}
{{- end }}
